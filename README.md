# Конкурсные списки — GUI-приложение на Tkinter

Добро пожаловать! Это проект для работы со списками абитуриентов: загрузка XLSX, нормализация данных, фильтрация/поиск/сортировка, расчёт рекомендованных к зачислению, отчёты (CSV/PDF) и графики истории проходных баллов.

Проект уже содержит генератор тестовых наборов (spisok.py), проверочный отчёт (proverka.py) и полноценное настольное приложение (start.py).

---

## Содержание проекта

Папки:
- `start` — входные XLSX списки (генерируются скриптом spisok.py)
- `spiski` — загруженные в БД нормализованные CSV по ОП/дате
- `lists` — сформированные CSV «рекомендованные к зачислению»
- `report` — PDF-отчёты (проходные, графики)
- `otchet` — аналитические CSV (otchet.csv, otchet2.csv)

Ключевые файлы:
- `start.py` — главное GUI-приложение «Конкурсные списки»
- `spisok.py` — генератор входных XLSX и сценарий пост-обработки по дням
- `proverka.py` — проверочный отчёт по пересечениям/приоритетам
- `абитуρиенты.csv` — база данных (нормализованные записи всех загрузок)
- `history.csv` — история проходных (ведётся приложением при расчёте списков)
- `history_test.csv` — история проходных, сформированная сценарием из spisok.py
- `programs.csv` — конфигурация ОП и количества мест
- `date_list.csv` — конфигурация дат приёма
- `zapusk.csv` — отметки, какие ОП/даты уже загружены
- `1.png` — логотип команды для приветственного окна

---

## Быстрый старт

1) Установите Poetry (если ещё не установлен):
- Windows/macOS: по инструкции на https://python-poetry.org/docs/
- Linux: `curl -sSL https://install.python-poetry.org | python3 -`

2) Установите зависимости проекта:
- В корне проекта выполните: `poetry install`

3) Запустите приложение:

- `poetry run python start.py`

При первом запуске откроется приветственное окно, затем основной интерфейс.

---

## Основные возможности (start.py)

- Загрузка XLSX списков по ОП/дате (меню «Файл» → «Загрузить список …»)
- Нормализация заголовков/типов, расчёт сумм баллов, upsert в БД (`абитуρиенты.csv`)
- Просмотр актуальной БД, просмотр загруженных списков по ОП/дате
- Фильтры по согласию («Да/Нет») и приоритету (1..4); быстрый поиск ID
- Сортировки по основным колонкам (восх./убыв.)
- Расчёт рекомендованных к зачислению (меню «Списки» → «Сформировать списки…»)
  - Алгоритм: по уровням приоритета 1→4, с учётом согласия и мест по ОП
  - Сохраняет CSV в `lists/` и обновляет `history.csv`
- Отчёты: сводная статистика по ОП, PDF «К зачислению», график динамики проходных, просмотр аналитических CSV

Папки `spiski`, `lists`, `report`, `otchet`, `start` создаются автоматически.

---

## Генерация тестовых наборов

Вариант А (через приложение):
- Меню «Файл» → «Генератор списков…» — запустит `spisok.py` и `proverka.py`, очистит временные данные (оставляя заголовки CSV), заполнит `start/*.xlsx`, создаст `otchet/otchet.csv` и `otchet/otchet2.csv`, а также выполнит пост-обработку дней (см. ниже).

Вариант Б (через консоль):
- `poetry run generate-xlsx` — сгенерирует входные XLSX и `otchet/otchet.csv`
- `poetry run postprocess` — выполнил пост-обработку дней 01.08–04.08, сформировал `history_test.csv`
- `poetry run python proverka.py` — создаст `otchet/otchet2.csv`

### Что делает spisok.py

- Часть 1: генератор наборов с контролем пересечений ID, непротиворечивыми приоритетами и сохранением в `start/*.xlsx`; создаёт `otchet/otchet.csv` (число уникальных ID по группам дней).
- Часть 2: сценарий «zadanie» — для дней 01.08–04.08:
  - Микширует согласия (целевые доли «Да»), унифицирует суммы по ID внутри дня
  - Выбирает 1-й приоритет без пересечений по стратегиям
  - Корректирует минимальные суммы (через «Физика/ИКТ») для соблюдения правил роста/порядка проходных
  - Сохраняет результирующие XLSX и `history_test.csv`

### Что проверяет proverka.py

- Считает пересечения ID по парам/тройкам/четвёркам внутри каждой дневной группы
- Контролирует дубли приоритетов у одного ID внутри группы файлов
- Сохраняет отчёт `otchet/otchet2.csv`

---

## Конфигурация

- ОП и места: меню «Настройки» → «ОП и Количество мест…» или файл `programs.csv` (колонки: «ОП», «Количество мест»)
- Даты приёма: меню «Настройки» → «Даты приёма…» или файл `date_list.csv` (по одной дате на строку, формат ДД.ММ)

Приложение само создаст эти файлы при первом запуске, если их нет.

---

## Требования и зависимости

- Python: 3.10–3.12 (рекомендуется 3.11+)
- Пакеты (ставятся через Poetry):
  - pandas (чтение/запись CSV/XLSX)
  - openpyxl (движок Excel)
  - pillow (PIL, картинка фона/приветствие)
  - matplotlib (графики истории)
  - reportlab (PDF-отчёты)
- Tkinter: входит в стандартную библиотеку Python, но на Linux может потребоваться пакет `python3-tk`.

Если какой‑то пакет не установлен, GUI покажет понятное сообщение с подсказкой (`pip install …`). При работе через Poetry всё поставится автоматически.

---

## Как работать пошагово

1) Настройте ОП/места и даты (меню «Настройки»)
2) Сгенерируйте тестовые XLSX (меню «Файл» → «Генератор списков…» или `poetry run generate-xlsx` + `poetry run postprocess`)
3) Загрузите XLSX в БД (меню «Файл» → «Загрузить список …») по нужной ОП/дате
4) Просматривайте/фильтруйте/сортируйте данные в GUI
5) Сформируйте списки «к зачислению» (меню «Списки» → «Сформировать списки…») и откройте результаты по каждой ОП
6) Сохраните PDF‑отчёты (меню «Отчёты» → «К зачислению (в PDF)…») и график истории (меню «Отчёты» → «График» → «Сохранить график»)

---

## Важные файлы БД

- `абитуρиенты.csv` — единая БД всех загруженных записей (с колонкой «ОП»)
- `zapusk.csv` — отметки загруженных ОП/дат (для блокировки повторной загрузки в меню)
- `history.csv` — история проходных, пополняется при расчёте списков в GUI
- `spiski/*.csv` — нормализованные выгрузки по ОП/дате (без колонки «ОП»)
- `lists/*.csv` — рекомендованные к зачислению списки по ОП/дате (без «ОП», отсортированные по сумме и предметам)

---

## Известные нюансы

- На Linux/macOS убедитесь, что Tkinter доступен системе (иначе `tk.Tk()` не создаст окно)
- Для корректной кириллицы в PDF `start.py` старается зарегистрировать шрифт Arial/DejaVuSans, иначе используется Helvetica
- Backend matplotlib установлен в «Agg», графики отображаются в отдельном Tk‑окне

---

## Лицензия

Лицензия не указана. Добавьте нужную лицензию при интеграции в ваш репозиторий.

---

## Полезные команды

- Установка: `poetry install`
- Запуск GUI: `poetry run python start.py`
- Генерация входных XLSX: `poetry run generate-xlsx`
- Пост‑обработка дней и история проходных: `poetry run postprocess`
- Проверочный отчёт: `poetry run python proverka.py`


